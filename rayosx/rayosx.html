<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Scanner Pro: Limpieza y Residuos</title>
    <style>
        :root { --primary: #4f0b7b; --accent: #ef950a; --danger: #e74c3c; }
        body { margin: 0; background: #1a1a1a; font-family: 'Lato', sans-serif; color: white; overflow: hidden; }
        
        #game-wrapper { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* --- CAPAS DEL ESC√ÅNER --- */
        #viewport {
            position: relative; width: 1000px; height: 562px;
            border: 5px solid #333; overflow: hidden; cursor: none;
        }

        /* Capa 1: Escena Normal (Lo que se ve a simple vista) */
        .layer { position: absolute; inset: 0; background-size: cover; background-position: center; }
        #layer-normal { 
            background-image: url('normal.png'); 
            z-index: 1; 
        }

        /* Capa 2: Escena Riesgo (Lo que revela el esc√°ner) */
        #layer-risk { 
            background-image: url('riesgos.png'); 
            z-index: 1;
            clip-path: circle(80px at -100% -100%); /* Oculto inicialmente */
        }

        /* --- OBJETOS INTERACTIVOS (Solo visibles en capa riesgo) --- */
        .hotspot {
            position: absolute; width: 60px; height: 60px;
            border-radius: 50%; border: 3px solid var(--accent);
            background: rgba(239, 149, 10, 0.4);
            display: none; z-index: 10; cursor: pointer;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }

        /* --- UI Y MEN√öS --- */
        #ui-msg { position: absolute; top: 20px; background: rgba(0,0,0,0.8); padding: 15px 30px; border-radius: 30px; border: 2px solid var(--primary); z-index: 100; text-align: center; }
        
        #quiz-modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #222; border: 4px solid var(--primary); padding: 30px;
            border-radius: 15px; z-index: 200; display: none; width: 400px;
        }
        .option-btn {
            display: block; width: 100%; padding: 12px; margin: 10px 0;
            background: #333; border: 1px solid #555; color: white;
            cursor: pointer; text-align: left; border-radius: 5px;
        }
        .option-btn:hover { background: var(--primary); }

        #custom-cursor {
            position: absolute; width: 160px; height: 160px;
            border: 2px solid var(--accent); border-radius: 50%;
            pointer-events: none; z-index: 150; transform: translate(-50%, -50%);
            box-shadow: 0 0 0 1000vw rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <div id="ui-msg">
            <b style="color: var(--accent);">MODO INSPECCI√ìN:</b> Mueve el esc√°ner para encontrar 3 riesgos ocultos en Recepci√≥n y descarga.
        </div>

        <div id="viewport">
            <div id="layer-normal" class="layer"></div>
            <div id="layer-risk" class="layer"></div>
            <div id="custom-cursor"></div>

            <div class="hotspot" id="risk-quimico" style="top: 300px; left: 200px;" title="Mezcla de qu√≠micos"></div>
            <div class="hotspot" id="risk-vidrio" style="top: 400px; left: 750px;" title="Vidrios sobresaliendo"></div>
            <div class="hotspot" id="risk-piso" style="top: 450px; left: 450px;" title="Piso resbaladizo"></div>
        </div>

        <div id="quiz-modal">
            <h3 id="quiz-title">¬øQu√© riesgo detectaste?</h3>
            <div id="options-container"></div>
        </div>
    </div>

    <script>
        const viewport = document.getElementById('viewport');
        const layerRisk = document.getElementById('layer-risk');
        const cursor = document.getElementById('custom-cursor');
        const modal = document.getElementById('quiz-modal');
        const hotspots = document.querySelectorAll('.hotspot');
        
        let riesgosCorregidos = 0;
        let activeRisk = null;

        // Matriz de detecci√≥n de riesgos (0 = sin riesgo, 1 = con riesgo)
        // Ajusta esta matriz seg√∫n las posiciones de riesgos en tu imagen
        const GRID_ROWS = 10;
        const GRID_COLS = 10;
        
        // Ejemplo de matriz - personaliza seg√∫n tus necesidades
        const riskMatrix = [
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,1,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,1,0],
            [0,0,0,1,1,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,1,0,0,0,1,0,0,0,0],
            [0,1,0,0,0,1,1,0,0,1],
            [0,0,0,0,0,1,1,0,0,1]
        ];

        let riesgosEncontrados = new Set();

        const dataRiesgos = {
            'risk-quimico': {
                pregunta: "Has detectado cloro y amonio mezclados. ¬øCu√°l es la medida preventiva?",
                opciones: [
                    { t: "No mezclar productos bajo ninguna circunstancia.", correcta: true, feedback: "¬°Wena! Las mezclas generan gases t√≥xicos peligrosos." },
                    { t: "Mezclarlos r√°pido para limpiar mejor.", correcta: false, feedback: "¬°La cagas! Eso libera gases que te pueden intoxicar." }
                ]
            },
            'risk-vidrio': {
                pregunta: "Vidrios rotos sobresalen de la bolsa. ¬øQu√© debiste hacer?",
                opciones: [
                    { t: "Compactar la bolsa con las manos.", correcta: false, feedback: "¬°Ni se te ocurra! Riesgo de corte profundo." },
                    { t: "Colocar vidrios en caja r√≠gida y etiquetar.", correcta: true, feedback: "¬°Eso es! Cuidado colectivo para no herir a otros." }
                ]
            },
            'risk-piso': {
                pregunta: "Detectaste un charco de agua sin se√±alizar. ¬øAcci√≥n inmediata?",
                opciones: [
                    { t: "Esperar a que se seque solo.", correcta: false, feedback: "¬°Peligro! Alguien se va a sacar la chucha." },
                    { t: "Se√±alizar inmediatamente con letrero de advertencia.", correcta: true, feedback: "¬°Impeque! Evitas ca√≠das al mismo nivel." }
                ]
            }
        };

        // Movimiento del Esc√°ner
        viewport.addEventListener('mousemove', (e) => {
            const rect = viewport.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            layerRisk.style.clipPath = `circle(80px at ${x}px ${y}px)`;
            cursor.style.left = `${x}px`;
            cursor.style.top = `${y}px`;

            // Mostrar hotspot si el esc√°ner pasa por encima
            hotspots.forEach(hs => {
                const hsRect = hs.getBoundingClientRect();
                const dist = Math.hypot(e.clientX - (hsRect.left + 30), e.clientY - (hsRect.top + 30));
                if(dist < 80) hs.style.display = 'block';
            });
        });

        // Click en la imagen - detecci√≥n por matriz
        viewport.addEventListener('click', (e) => {
            const rect = viewport.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Calcular celda de la matriz
            const cellWidth = rect.width / GRID_COLS;
            const cellHeight = rect.height / GRID_ROWS;
            const col = Math.floor(x / cellWidth);
            const row = Math.floor(y / cellHeight);

            // Verificar si est√° dentro de los l√≠mites
            if (row >= 0 && row < GRID_ROWS && col >= 0 && col < GRID_COLS) {
                const cellKey = `${row}-${col}`;
                
                if (riskMatrix[row][col] === 1) {
                    // ¬°Encontr√≥ un riesgo!
                    if (!riesgosEncontrados.has(cellKey)) {
                        riesgosEncontrados.add(cellKey);
                        alert(`‚úÖ ¬°Riesgo detectado! Posici√≥n: Fila ${row+1}, Columna ${col+1}`);
                        
                        // Marcar visualmente
                        const marker = document.createElement('div');
                        marker.style.position = 'absolute';
                        marker.style.left = `${col * cellWidth}px`;
                        marker.style.top = `${row * cellHeight}px`;
                        marker.style.width = `${cellWidth}px`;
                        marker.style.height = `${cellHeight}px`;
                        marker.style.background = 'rgba(46, 204, 113, 0.5)';
                        marker.style.border = '2px solid #2ecc71';
                        marker.style.zIndex = '5';
                        marker.style.pointerEvents = 'none';
                        viewport.appendChild(marker);
                        
                        // Verificar si encontr√≥ todos
                        const totalRiesgos = riskMatrix.flat().filter(v => v === 1).length;
                        if (riesgosEncontrados.size === totalRiesgos) {
                            setTimeout(() => {
                                alert("üéâ ¬°Felicidades! Has encontrado todos los riesgos.");
                            }, 500);
                        }
                    } else {
                        alert("‚ö†Ô∏è Ya encontraste este riesgo.");
                    }
                } else {
                    // No hay riesgo aqu√≠
                    alert(`‚ùå No hay ning√∫n riesgo aqu√≠. Sigue buscando...`);
                }
            }
        });

        // Click en un Riesgo
        hotspots.forEach(hs => {
            hs.onclick = () => {
                activeRisk = hs;
                const info = dataRiesgos[hs.id];
                document.getElementById('quiz-title').innerText = info.pregunta;
                const container = document.getElementById('options-container');
                container.innerHTML = "";
                
                info.opciones.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerText = opt.t;
                    btn.onclick = () => responder(opt);
                    container.appendChild(btn);
                });
                modal.style.display = 'block';
            };
        });

        function responder(opt) {
            alert(opt.feedback);
            if(opt.correcta) {
                modal.style.display = 'none';
                activeRisk.style.background = "rgba(46, 204, 113, 0.6)";
                activeRisk.style.borderColor = "#2ecc71";
                activeRisk.onclick = null;
                riesgosCorregidos++;
                if(riesgosCorregidos === 3) {
                    alert("¬°Misi√≥n Cumplida! Has identificado y prevenido todos los riesgos ocultos. üóøü§ôüî•");
                    location.reload();
                }
            }
        }
    </script>
</body>
</html>